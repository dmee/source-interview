# 浏览器缓存机制

## 一、缓存工作原理

1. 浏览器在请求某一资源时，会先获取该资源缓存的header信息，判断是否命中强缓存（Cache-Control和Expires信息），若命中直接从缓存中获取资源信息，包括缓存header信息，本次请求就不会与服务器进行通信。
2. 如果没有命中强缓存，浏览器会发送请求到服务器，请求会携带第一次返回的有关缓存的header字段信息（Last-Modifued/If-Modified-Since和Etag/If-None-Match），由服务器根据header信息来比对结果是否协商缓存命中。若命中，则服务器返回新的响应header信息更新缓存中的对应header信息，但是不返回资源内容，它会告知浏览器可以直接从缓存获取；否则返回最新的资源内容。

![浏览器缓存流程](../Resources/images/browser_cache.png)

## 二、常见请求头

### 1. Expires

在响应http请求时告诉浏览器在过期时间前浏览器可以直接从浏览器缓存取数据，而无需再次请求。

- 设置失效时间，精确到时分秒
- Expires 是**HTTP 1.0**的东西，现在默认浏览器均默认使用**HTTP 1.1**，所以它的作用基本忽略。

### 2. Cache-Control

Cache-Control与Expires的作用一致，都是指明当前资源的有效期，控制浏览器是否直接从浏览器缓存取数据还是重新发请求到服务器取数据。只不过Cache-Control的选择更多，设置更细致，如果同时设置的话，其优先级高于Expires。

#### 取值

- **public**：指示响应可被任何缓存区缓存。
- **private**：对于单个用户的整个或部分响应消息，不能被共享缓存处理。这允许服务器仅仅描述当用户的部分响应消息，此响应消息对于其他用户的请求无效。
- **no-cache**：请求或响应消息不能缓存
- **no-store**：防止重要的信息被无意的发布。在请求消息中发送将使得请求和响应消息都不使用缓存
- **max-age**：指示客户机可以接收生存期不大于指定时间（以秒为单位）的响应
- **min-fresh**：指示客户机可以接收响应时间小于当前时间加上指定时间的响应
- **max-stale**：客户机可以接收超出超时期间的响应消息。如果指定max-stale消息的值，那么客户机可以接收超出超时期指定值之内的响应消息\

## 二、什么是强制缓存？

## 三、什么是协商缓存？

## 四、强缓存与协商缓存的区别

 |缓存|获取资源方式|状态码|是否与服务器交互|
 |:--:|:--:|:--:|:--:|
 |强缓存|从缓存中取|200(from cache)|否|
 |协商缓存|从缓存中取|304(not modified)|是|

## 五、参考文章

 1. [强制缓存（200）和协商缓存（304）整理](https://blog.csdn.net/zl399615007/article/details/84534884)